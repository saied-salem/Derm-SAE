DermLIP Patch-SAE CBM PipelineThis project implements the full pipeline to build and visualize a "Patch-SAE" Concept Bottleneck Model, inspired by the Mammo-SAE and Discover-then-Name papers, on your HAM10000 dataset.The pipeline is broken into 6 sequential steps. For each step (except the first), there is:A Python script (e.g., 02_prepare_features.py)A local shell runner (e.g., 02_run_features.sh)An HPC/Slurm runner (e.g., 02_run_features.sbatch)WorkflowYou must run these scripts in order.Step 0: SetupPlace your concept.csv and selected_concepts.json in this directory.Install all required libraries:pip install -r requirements.txt

Step 1: Prepare VocabularyThis script merges your CSV and JSON concept lists into a single master_vocabulary.txt../01_run_vocab.sh

Step 2: Extract Features & EmbeddingsThis script loads your HAM10000 images, runs the DermLIP model, and saves all patch features (.pt) and text embeddings (.pt).Edit 02_run_features.sh to set your local data paths.Run: ./02_run_features.sh(HPC users: Edit and submit 02_run_features.sbatch)Step 3: Train Sparse Autoencoder (SAE)This script trains the SAE on the patch features from Step 2. This is the most computationally expensive step.Edit the .sh or .sbatch file to configure hyperparameters (like EXPANSION_FACTOR, NUM_EPOCHS).Run: ./03_run_train_sae.sh(HPC users: Submit 03_run_train_sae.sbatch)Step 4: Name Discovered ConceptsThis script compares the trained SAE neurons (from Step 3) to the text embeddings (from Step 2) and saves a dictionary of named concepts.Run: ./04_run_name_concepts.sh(HPC users: Submit 04_run_name_concepts.sbatch)Step 5: Train CBM ClassifierThis script builds the full $$Backbone -> SAE -> Classifier$$ model and trains only the final classifier layer on the HAM10000 images.Edit 05_run_train_classifier.sh to set your local data paths.Run: ./05_run_train_classifier.sh(HPC users: Edit and submit 05_run_train_classifier.sbatch)Step 6: Visualize ConceptsThis script loads the fully trained model and generates a heatmap visualization for a single image, showing the top-contributing concepts.Edit 06_run_visualize.sh to point to a test image you want to visualize.Run: ./06_run_visualize.sh(HPC users: Edit and submit 06_run_visualize.sbatch)